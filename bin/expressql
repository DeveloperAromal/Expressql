#!/usr/bin/env node

try {
  const ma = require("module-alias/register");
} catch (err) {
  console.error(err && err.message);
}

// Ensure aliases are registered explicitly (fallback) so `@utils` etc. resolve
try {
  const path = require("path");
  const moduleAlias = require("module-alias");
  const root = path.resolve(__dirname, "..");
  moduleAlias.addAliases({
    "@utils": path.join(root, "dist", "utils"),
    "@core": path.join(root, "dist", "core"),
    "@cli": path.join(root, "dist", "cli"),
  });
} catch (e) {
  // not fatal; continue â€” the register above may have worked
}

try {
  const resolved = require.resolve("@utils/Logger");
} catch (err) {
  console.error(
    "[expressql] debug: require.resolve(@utils/Logger) failed:",
    err && err.message,
  );
}

try {
  const cli = require("../dist/cli/index.js");
  const argv = process.argv.slice(2);
  if (argv[0] === "init" && typeof cli.initCommand === "function") {
    cli.initCommand(argv[1]);
  } else if (typeof cli.default === "function") {
    cli.default(argv);
  }
} catch (err) {
  console.error(err && err.stack ? err.stack : err);
  process.exit(1);
}
